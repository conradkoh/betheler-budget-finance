<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Current Tasks Progress Tracker</title>
    <meta
      name="description"
      content="Key information about current tasks and their progress"
    />
    <style>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      h1 {
        color: #2563eb;
      }
      h2 {
        color: #4b5563;
        margin-top: 24px;
      }
      .notice {
        background-color: #fef3c7;
        padding: 16px;
        border-radius: 8px;
        border-left: 4px solid #f59e0b;
        margin: 24px 0;
      }
      .changelog-link {
        background-color: #e0f2fe;
        padding: 16px;
        border-radius: 8px;
        border-left: 4px solid #0ea5e9;
        margin: 24px 0;
        text-align: center;
      }
      .changelog-link a {
        color: #0369a1;
        font-weight: bold;
        text-decoration: none;
      }
      .changelog-link a:hover {
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <!-- 
    IMPORTANT: READ BEFORE MODIFYING
    - Sections marked with 'importance: high' should not be removed or significantly altered unless explicitly instructed to do so.
    - The task lists under 'Detailed Technical Tasks' should be updated to reflect current progress.
    - Comments like this one are for guidance and should not be removed.
    - IMPORTANT: This file is synced across multiple users. Each user is responsible for updating
      the progress markers as they complete tasks.
  -->

    <h1>Current Tasks Progress Tracker</h1>

    <div class="changelog-link">
      <p>
        Detailed version history is now available in the
        <a href="./changelog/index.html">changelog directory</a>.
      </p>
    </div>

    <div class="notice">
      <p>
        <strong>Notice:</strong> The detailed version history has been moved to
        the changelog directory for better organization. This document now
        focuses on tracking the current active tasks and providing high-level
        project information.
      </p>
    </div>

    <section id="tech-stack">
      <h2>Tech Stack</h2>
      <meta name="importance" content="high" />
      <!-- 
      IMPORTANT: This section must be updated before working on any other tasks.
      -->
      <p>
        Please specify the technologies and frameworks used in this project.
      </p>
      <ul>
        <li>Next.js 15.2.2 - Frontend framework</li>
        <li>Convex - Backend service</li>
        <li>React 19.0.0 - JavaScript library for building user interfaces</li>
        <li>TypeScript - Programming language</li>
        <li>Tailwind CSS - Utility-first CSS framework</li>
        <li>Shadcn UI - UI component library</li>
        <li>pnpm - Package manager</li>
        <li>nx - Workspace tool</li>
        <li>Chart.js - Library for displaying charts</li>
        <li>date-fns - Date utility library</li>
      </ul>
    </section>

    <section id="overview">
      <h2>Overview</h2>
      <meta name="importance" content="high" />
      <!-- 
      DO NOT REMOVE: This section provides critical context for the entire document.
      You may update the content if project guidelines change, but maintain the overall structure.
    -->
      <p>
        This file contains key information about the tasks that you are
        currently working on.
      </p>
      <ul>
        <li>Each task should be about 1-3 story points</li>
        <li>
          If modifying existing functionality, do some research about existing
          function names, entities, naming enums, and key interface names and
          properties.
        </li>
        <li>
          Plan and include key details into each task for better consistency
          across tasks
        </li>
        <li>Update progress markers ([x], [.], [ ]) as you complete tasks</li>
      </ul>
    </section>

    <section id="project-structure">
      <h2>Project Structure</h2>
      <meta name="importance" content="high" />
      <!-- 
      DO NOT REMOVE: This section outlines the critical project structure.
      - Keep this structure updated as new components or modules are added
      - Maintain consistent naming conventions
      - Document any structural changes

      Structure Documentation Guidelines:
      - Focus on documenting:
        * Feature-specific directories and their purpose
        * Key architectural components (e.g. workspace packages)
        * Critical implementation locations such as:
          - Convex backend directory
          - React components directory
          - Shared utilities
      - Omit auxiliary files (e.g., framework configuration files, assets) unless they are
        critical to domain related feature implementation

      Naming Conventions:
      - React Components: PascalCase (e.g., BudgetList.tsx)
      - Utility functions: camelCase (e.g., formatCurrency.ts)
      - Database tables: camelCase (e.g., transactions)
      - Convex functions: camelCase (e.g., listTransactions)
      - Type definitions: PascalCase (e.g., TransactionType)
    -->
      <h3>Directory Structure</h3>
      <pre>
betheler-budget-finance/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îî‚îÄ‚îÄ webapp/              # Next.js frontend application
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ app/         # Next.js app router pages
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ components/  # React components
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ lib/         # Utility functions
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ modules/     # Feature modules
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ backend/             # Convex backend
‚îÇ       ‚îú‚îÄ‚îÄ convex/          # Convex functions and schema
‚îÇ       ‚îî‚îÄ‚îÄ types/           # TypeScript types
      </pre>
    </section>

    <section id="process">
      <h2>Process</h2>
      <meta name="importance" content="high" />
      <!-- 
      DO NOT REMOVE: This section outlines the critical process steps.
      Update only if the process changes, otherwise keep as is.
    -->
      <ol>
        <li>Update the tech stack before proceeding with any tasks.</li>
        <li>Do some research for the feature.</li>
        <li>
          Create a list of technical tasks with important information (file
          names, function names, component names, interface names, and enums
          where applicable)
        </li>
        <li>Start working on each task one by one.</li>
        <li>Run the type checks to ensure that everything is working.</li>
        <li>Run the tests to ensure that everything is working.</li>
        <li>
          Provide an update for the latest state of the task list and update
          this file.
        </li>
      </ol>
    </section>

    <section id="legend">
      <h2>Legend</h2>
      <meta name="importance" content="medium" />
      <!-- 
      This legend explains the task status markers.
      Update only if the status marking system changes.
    -->
      <ul>
        <li>[ ] - Not started</li>
        <li>[.] - In progress</li>
        <li>[x] - Completed</li>
      </ul>
    </section>

    <section id="technical-tasks">
      <h2>Technical Tasks</h2>
      <meta name="importance" content="high" />
      <!-- Current active tasks -->
      <section id="v1.5.0">
        <meta name="version" content="1.5.0" />
        <h1>
          üìç Current Version: 1.5.0 - Proper Fund Allocation in Shared View
        </h1>
        <section feature="fund-allocation-enhancement">
          <h3>Proper Fund Allocation in Shared View</h3>
          <ul>
            <li>
              <strong>Backend Enhancements</strong>
              <ul>
                <li>
                  [x] Create getSharedFinancialSummary API endpoint in
                  services/backend/convex/sharing.ts
                </li>
                <li>
                  [x] Create getSharedBudgetDetails API endpoint in
                  services/backend/convex/sharing.ts
                </li>
              </ul>
            </li>
            <li>
              <strong>Shared View Updates</strong>
              <ul>
                <li>
                  [x] Update SharedTransactionView to use new API endpoints in
                  apps/webapp/src/components/SharedTransactionView.tsx
                </li>
                <li>
                  [x] Implement proper fund allocation calculation with savings,
                  budget categories, and unallocated funds
                </li>
                <li>
                  [x] Improve UI to match main app's fund allocation
                  visualization
                </li>
              </ul>
            </li>
          </ul>
          <p>
            <strong>Implementation Notes:</strong> This enhancement improves the
            shared view's fund allocation chart to match the main app's
            functionality. The implementation includes: 1. New API endpoints in
            the backend for retrieving shared financial summaries and budget
            data 2. Updated fund allocation calculation that properly shows
            savings, budget categories, and unallocated funds 3. Enhanced UI
            with additional financial information to provide better context to
            shared view recipients The implementation now provides users who
            receive shared links with the same level of insight into fund
            allocation as seen in the main app dashboard.
          </p>
        </section>
      </section>

      <!-- Version 1.5.1 -->
      <section id="v1.5.1">
        <meta name="version" content="1.5.1" />
        <h1>
          üìç Current Version: 1.5.1 - Consistency and Efficiency Improvements
        </h1>
        <section feature="reusable-financial-overview">
          <h3>Reusable Read-Only Financial Overview</h3>
          <ul>
            <li>
              <strong>Component Creation</strong>
              <ul>
                <li>
                  [x] Create FinancialOverview component in
                  apps/webapp/src/components/FinancialOverview.tsx
                </li>
                <li>
                  [x] Extract financial overview UI from app/page.tsx with
                  read-only mode parameter
                </li>
                <li>
                  [x] Create proper component props interface with readOnly
                  option
                </li>
                <li>
                  [x] Create dedicated SharedFinancialOverview component for
                  shared views
                </li>
              </ul>
            </li>
            <li>
              <strong>Integration</strong>
              <ul>
                <li>
                  [x] Update app/page.tsx to use the new FinancialOverview
                  component
                </li>
                <li>
                  [x] Update SharedTransactionView to use
                  SharedFinancialOverview component
                </li>
                <li>
                  [x] Ensure consistent UI between main dashboard and shared
                  view
                </li>
              </ul>
            </li>
            <li>
              <strong>Polishing</strong>
              <ul>
                <li>
                  [x] Add responsive layout for side-by-side sections on desktop
                </li>
                <li>
                  [x] Add icons to tabs in the shared view for better visual
                  consistency
                </li>
                <li>[x] Show original user's name in the shared view header</li>
                <li>
                  [x] Include detailed Monthly Summary section in shared view
                </li>
              </ul>
            </li>
          </ul>
          <p>
            <strong>Implementation Notes:</strong> This feature creates a
            reusable FinancialOverview component for the main dashboard and a
            dedicated SharedFinancialOverview component for shared views. This
            approach provides better separation of concerns by keeping the
            authenticated and public components separate, which improves
            maintainability and prevents session-related errors. Both components
            have a consistent UI to ensure a seamless user experience.
            Additional polishing ensures the shared view has a professional
            appearance with proper attribution to the original user who shared
            the data.
          </p>
        </section>

        <section feature="inline-transaction-creation">
          <h3>Inline Transaction Creation Modal</h3>
          <ul>
            <li>
              <strong>Modal Component</strong>
              <ul>
                <li>
                  [x] Create TransactionModal component in
                  apps/webapp/src/components/TransactionModal.tsx
                </li>
                <li>
                  [x] Implement dialog-based modal that reuses TransactionForm
                </li>
                <li>
                  [x] Add proper open/close state management and callback
                  handlers
                </li>
              </ul>
            </li>
            <li>
              <strong>Dashboard Integration</strong>
              <ul>
                <li>
                  [x] Update Quick Actions in app/page.tsx to open transaction
                  modal directly
                </li>
                <li>
                  [x] Replace "View Transactions" button with "Add Transaction"
                  that opens the modal
                </li>
                <li>
                  [x] Add event handlers to refresh financial data after
                  transaction creation
                </li>
              </ul>
            </li>
          </ul>
          <p>
            <strong>Implementation Notes:</strong> This enhancement creates a
            modal for adding transactions directly from the dashboard,
            eliminating the need to navigate to a separate page. The
            implementation will use the standard dialog component from the UI
            library and reuse the existing TransactionForm component. This
            improves user experience by allowing users to stay on the dashboard
            while adding transactions and immediately see the effects of their
            actions.
          </p>
        </section>

        <section feature="user-leaderboard">
          <h3>User Transaction Leaderboard</h3>
          <ul>
            <li>
              <strong>Backend</strong>
              <ul>
                <li>
                  [x] Create getUserTransactionLeaderboard API in
                  services/backend/convex/transactions.ts
                </li>
                <li>[x] Implement ranking logic based on transaction counts</li>
              </ul>
            </li>
            <li>
              <strong>Leaderboard Page</strong>
              <ul>
                <li>
                  [x] Create LeaderboardPage in
                  apps/webapp/src/app/leaderboard/page.tsx
                </li>
                <li>[x] Implement MonthYearPicker for date navigation</li>
                <li>
                  [x] Display ranked users with medal icons for top performers
                </li>
                <li>[x] Highlight the current user in the leaderboard</li>
                <li>
                  [x] Enhance UI with special styling for top 3 performers
                </li>
                <li>
                  [x] Add crown emoji and trophy icon to make the page more
                  engaging
                </li>
                <li>[x] Center month selector for better user experience</li>
                <li>[x] Show up to 50 top users in the leaderboard</li>
              </ul>
            </li>
            <li>
              <strong>Navigation</strong>
              <ul>
                <li>[x] Add leaderboard link to UserMenu component</li>
                <li>[x] Add leaderboard link to main Navigation component</li>
                <li>[x] Add leaderboard link to landing page</li>
              </ul>
            </li>
          </ul>
          <p>
            <strong>Implementation Notes:</strong> This feature adds a
            competitive element to the application by ranking users based on the
            number of transactions they create each month. The leaderboard uses
            the existing MonthYearPicker component to allow users to view
            rankings for different months. Top performers are highlighted with
            gold, silver, and bronze medal icons, with special background colors
            and a crown emoji for the #1 position. The current user is
            highlighted in the list for easy identification. The design has been
            enhanced with visual elements like trophy icons, rounded transaction
            counters, and hover effects to make the experience more engaging.
            The leaderboard shows up to 50 users, and the month selector is now
            centered above the leaderboard for better usability.
          </p>
        </section>
      </section>

      <!-- Upcoming tasks for next version -->
      <section id="upcoming-tasks">
        <h1>üìç Upcoming Tasks</h1>
        <section feature="month-selector-sharing">
          <h3>Month Selector for Shared View</h3>
          <ul>
            <li>
              <strong>Backend Updates</strong>
              <ul>
                <li>
                  [x] Update getSharedTransactions to accept month and year
                  parameters in services/backend/convex/sharing.ts
                </li>
                <li>
                  [x] Update getSharedCategorySummary to accept month and year
                  parameters in services/backend/convex/sharing.ts
                </li>
                <li>
                  [x] Update getSharedFinancialSummary to accept month and year
                  parameters in services/backend/convex/sharing.ts
                </li>
                <li>
                  [x] Update getSharedBudgetProgress to accept month and year
                  parameters in services/backend/convex/sharing.ts
                </li>
              </ul>
            </li>
            <li>
              <strong>Frontend Implementation</strong>
              <ul>
                <li>
                  [x] Add date state to SharedTransactionView in
                  apps/webapp/src/components/SharedTransactionView.tsx
                </li>
                <li>
                  [x] Implement MonthYearPicker component in the shared view
                </li>
                <li>[x] Pass month/year parameters to all API calls</li>
                <li>
                  [x] Style the month selector to match the main app dashboard
                </li>
              </ul>
            </li>
          </ul>
          <p>
            <strong>Implementation Notes:</strong> This feature enhances the
            shared view by adding a month selector, similar to the one in the
            main dashboard. This allows users who receive shared links to view
            historical data by paging through different months, rather than only
            seeing the most recent data. The implementation requires updating
            the backend API endpoints to accept month and year parameters and
            modifying the frontend to include and use the MonthYearPicker
            component.
          </p>
        </section>

        <section feature="expenses-calculation">
          <h3>Fix for Zero Expenses in Spending Overview</h3>
          <ul>
            <li>
              <strong>Investigation</strong>
              <ul>
                <li>
                  [x] Investigate why expenses appear in transaction list but
                  show as 0 in spending overview
                </li>
              </ul>
            </li>
            <li>
              <strong>Implementation</strong>
              <ul>
                <li>[x] Fix expense calculation in relevant components</li>
                <li>
                  [x] Ensure transactionType filtering is properly applied
                </li>
              </ul>
            </li>
          </ul>
          <p>
            <strong>Implementation Notes:</strong> This patch fixes a critical
            issue where expense transactions are visible in the transaction list
            but show up as 0 in the spending overview section. We found that the
            transaction summary calculation in the SharedTransactionView
            component was incorrectly summing transaction amounts without
            considering their types, causing expenses (negative values) to be
            incorrectly balanced with income (positive values). The fix includes
            adding a proper type-specific total calculation to correctly show
            the net cash flow. We've also fixed an HTML nesting issue in the
            SharedTransactionView component where a div element was incorrectly
            nested inside a p tag, which was causing hydration errors.
          </p>
        </section>

        <section feature="budget-balance-feedback">
          <h3>Budget Balance Feedback in Budget Management</h3>
          <ul>
            <li>
              <strong>Component Creation</strong>
              <ul>
                <li>
                  [x] Create BudgetBalanceSummary component in
                  apps/webapp/src/components/BudgetBalanceSummary.tsx
                </li>
                <li>
                  [x] Implement conditional feedback based on budget balance
                  status
                </li>
                <li>
                  [x] Show detailed budget summary when budget is not balanced
                </li>
              </ul>
            </li>
            <li>
              <strong>Integration</strong>
              <ul>
                <li>
                  [x] Update BudgetsPage in apps/webapp/src/app/budgets/page.tsx
                  to include the BudgetBalanceSummary component
                </li>
                <li>
                  [x] Ensure proper data flow from budgets and transactions APIs
                </li>
              </ul>
            </li>
            <li>
              <strong>UI Enhancements</strong>
              <ul>
                <li>
                  [x] Center the budget summary content for better visual
                  balance
                </li>
                <li>[x] Make the remaining budget amount more prominent</li>
                <li>
                  [x] Add "Add Budget" button directly in the warning message
                </li>
                <li>[x] Highlight overbudgeted amounts in red</li>
              </ul>
            </li>
          </ul>
          <p>
            <strong>Implementation Notes:</strong> This feature enhances the
            Budget Management page by adding a feedback component that shows
            users whether their budget is balanced (matches their spendable
            income). When a budget is balanced, users see positive feedback with
            a green checkmark. When unbalanced, users see an alert with the
            exact amount they need to budget (or reduce) to match their
            spendable income, along with a detailed summary breakdown. The
            implementation uses the existing getMonthlyFinancialSummary and
            getTotalBudgetSummary API endpoints to get the necessary data for
            comparison. This helps users track every dollar of their income and
            ensures they have a complete budget for the month. The UI has been
            enhanced with a centered layout, prominent display of the budget
            amount, integrated "Add Budget" button, and red highlighting for
            overbudgeted amounts.
          </p>
        </section>
      </section>
    </section>
  </body>
</html>
